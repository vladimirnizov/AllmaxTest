!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/operators"),require("rxjs"),require("tslib")):"function"==typeof define&&define.amd?define("@ngxs/store",["exports","@angular/core","rxjs/operators","rxjs","tslib"],e):e((t.ngxs=t.ngxs||{},t.ngxs.store={}),t.ng.core,t.Rx.Observable.prototype,t.rxjs,t.tslib)}(this,function(t,e,b,m,O){"use strict";var r=new e.InjectionToken("ROOT_STATE_TOKEN"),n=new e.InjectionToken("FEATURE_STATE_TOKEN"),w="NGXS_META",u="NGXS_SELECTOR_META",o=new e.InjectionToken("NGXS_PLUGINS"),a=function(){};function h(t){if(!t.hasOwnProperty(w)){Object.defineProperty(t,w,{value:{name:null,actions:{},defaults:{},path:null,children:[],instance:null}})}return s(t)}function s(t){return t[w]}function c(t){return t[u]}function i(t){for(var e=t,r="store."+e[0],n=0,o=e.length,a=r;++n<o;)a=a+" && "+(r=r+"."+e[n]);return new Function("store","return "+a+";")}function x(t){return t.constructor&&t.constructor.type?t.constructor.type:t.type}var p=function(t,e,n){t=Object.assign({},t);var r=e.split("."),o=r.length-1;return r.reduce(function(t,e,r){return t[e]=r===o?n:Object.assign({},t[e]),t&&t[e]},t),t},f=function(t,e){return e.split(".").reduce(function(t,e){return t&&t[e]},t)};function j(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l(t,"DISPATCHED")}function l(t,e){var r=t.reduce(function(t,e){return t[x(e)]=!0,t},{});return function(t){return t.pipe((n=r,o=e,b.filter(function(t){var e=x(t.action),r=n[e];return o?r&&t.status===o:r})),b.map(function(t){return t.action}));var n,o}}function d(r){return function(t){return new m.Observable(function(e){return t.subscribe({next:function(t){r.run(function(){return e.next(t)})},error:function(t){r.run(function(){return e.error(t)})},complete:function(){r.run(function(){return e.complete()})}})})}}var y=function(r){function t(){var t=r.apply(this,O.__spread(arguments))||this;return t._itemQueue=[],t._busyPushingNext=!1,t}return O.__extends(t,r),t.prototype.next=function(t){if(this._busyPushingNext)this._itemQueue.unshift(t);else{for(this._busyPushingNext=!0,r.prototype.next.call(this,t);0<this._itemQueue.length;){var e=this._itemQueue.pop();r.prototype.next.call(this,e)}this._busyPushingNext=!1}},t}(m.Subject),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return O.__extends(e,t),e}(y);v.decorators=[{type:e.Injectable}];var _=function(e){function t(t,r){return e.call(this,function(e){t.pipe(d(r)).subscribe(function(t){return e.next(t)},function(t){return e.error(t)},function(){return e.complete()})})||this}return O.__extends(t,e),t}(m.Observable);_.decorators=[{type:e.Injectable}],_.ctorParameters=function(){return[{type:v},{type:e.NgZone}]};var g=function(r){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.shift().apply(void 0,O.__spread(t,[function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return g(r).apply(void 0,O.__spread(t))}]))}},S=function(t){function e(){return t.call(this,{})||this}return O.__extends(e,t),e}(m.BehaviorSubject);S.decorators=[{type:e.Injectable}],S.ctorParameters=function(){return[]};var A=function(){function t(t,e){this._parentManager=t,this._plugins=e,this.plugins=[],this.register()}return t.prototype.register=function(){var t;this._plugins&&(this.plugins=this._plugins.map(function(t){return t.handle?t.handle.bind(t):t}),this._parentManager&&(t=this._parentManager.plugins).push.apply(t,O.__spread(this.plugins)))},t}();A.decorators=[{type:e.Injectable}],A.ctorParameters=function(){return[{type:A,decorators:[{type:e.Optional},{type:e.SkipSelf}]},{type:Array,decorators:[{type:e.Inject,args:[o]},{type:e.Optional}]}]};var E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return O.__extends(e,t),e}(m.Subject);E.decorators=[{type:e.Injectable}];var P=function(){function t(t,e,r,n,o,a){this._errorHandler=t,this._actions=e,this._actionResults=r,this._pluginManager=n,this._stateStream=o,this._ngZone=a}return t.prototype.dispatch=function(t){var e=this,r=this._ngZone.runOutsideAngular(function(){return Array.isArray(t)?m.forkJoin(t.map(function(t){return e.dispatchSingle(t)})):e.dispatchSingle(t)});return r.subscribe({error:function(t){return e._ngZone.run(function(){return e._errorHandler.handleError(t)})}}),r.pipe(d(this._ngZone))},t.prototype.dispatchSingle=function(t){var n=this,o=this._stateStream.getValue(),e=this._pluginManager.plugins;return g(O.__spread(e,[function(t,e){t!==o&&n._stateStream.next(t);var r=n.getActionResultStream(e);return r.subscribe(function(t){return n._actions.next(t)}),n._actions.next({action:e,status:"DISPATCHED"}),n.createDispatchObservable(r)}]))(o,t).pipe(b.shareReplay())},t.prototype.getActionResultStream=function(e){return this._actionResults.pipe(b.filter(function(t){return t.action===e&&"DISPATCHED"!==t.status}),b.take(1),b.shareReplay())},t.prototype.createDispatchObservable=function(t){var e=this;return t.pipe(b.exhaustMap(function(t){switch(t.status){case"SUCCESSFUL":return m.of(e._stateStream.getValue());case"ERRORED":return m.throwError(t.error);default:return m.empty()}})).pipe(b.shareReplay())},t}();P.decorators=[{type:e.Injectable}],P.ctorParameters=function(){return[{type:e.ErrorHandler},{type:v},{type:E},{type:A},{type:S},{type:e.NgZone}]};var I=function(e){Object.freeze(e);var r="function"==typeof e,n=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(e).forEach(function(t){!n.call(e,t)||r&&("caller"===t||"callee"===t||"arguments"===t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||I(e[t])}),e},R=function(){function t(t,e,r){this._stateStream=t,this._dispatcher=e,this._config=r}return t.prototype.getRootStateOperations=function(){var e=this,t={getState:function(){return e._stateStream.getValue()},setState:function(t){return e._stateStream.next(t)},dispatch:function(t){return e._dispatcher.dispatch(t)}};return this._config.developmentMode?this.ensureStateAndActionsAreImmutable(t):t},t.prototype.ensureStateAndActionsAreImmutable=function(r){return{getState:function(){return r.getState()},setState:function(t){var e=I(t);return r.setState(e)},dispatch:function(t){return r.dispatch(t)}}},t}();R.decorators=[{type:e.Injectable}],R.ctorParameters=function(){return[{type:S},{type:P},{type:a}]};var C=function(){function t(t){this._internalStateOperations=t}return t.prototype.createStateContext=function(u){var s=this._internalStateOperations.getRootStateOperations();return{getState:function(){var t=s.getState();return f(t,u.depth)},patchState:function(t){var e="object"!=typeof t;if(Array.isArray(t))throw new Error("Patching arrays is not supported.");if(e)throw new Error("Patching primitives is not supported.");var r=s.getState(),n=f(r,u.depth),o=Object.assign({},n);for(var a in t)o[a]=t[a];var i=p(r,u.depth,o);return s.setState(i),i},setState:function(t){var e=s.getState();return e=p(e,u.depth,t),s.setState(e),e},dispatch:function(t){return s.dispatch(t)}}},t}();C.decorators=[{type:e.Injectable}],C.ctorParameters=function(){return[{type:R}]};var T=function(){function t(t,e,r,n,o){this._injector=t,this._parentFactory=e,this._actions=r,this._actionResults=n,this._stateContextFactory=o,this._states=[],this._connected=!1}return Object.defineProperty(t.prototype,"states",{get:function(){return this._parentFactory?this._parentFactory.states:this._states},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e;e=Array.isArray(t)?t:[t];var r,a,n,o,i,u,s,c,p,f=(a=function(e){var t=r.find(function(t){return t===e});if(!t)throw new Error("Child state not found: "+e);if(!t[w])throw new Error("States must be decorated with @State() decorator");return t[w].name},(r=e).reduce(function(t,e){if(!e[w])throw new Error("States must be decorated with @State() decorator");var r=e[w],n=r.name,o=r.children;return t[n]=(o||[]).map(a),t},{})),l=(n=f,o=[],i={},u=function(e,r){void 0===r&&(r=[]),Array.isArray(r)||(r=[]),r.push(e),i[e]=!0,n[e].forEach(function(t){if(0<=r.indexOf(t))throw new Error("Circular dependency '"+t+"' is required by '"+e+"': "+r.join(" -> "));i[t]||u(t,r.slice(0))}),o.indexOf(e)<0&&o.push(e)},Object.keys(n).forEach(function(t){return u(t)}),o.reverse()),h=function(t,e){void 0===e&&(e={});var o=function(t,e){for(var r in t)if(t.hasOwnProperty(r)&&0<=t[r].indexOf(e)){var n=o(t,r);return null!==n?n+"."+r:r}return null};for(var r in t)if(t.hasOwnProperty(r)){var n=o(t,r);e[r]=n?n+"."+r:r}return e}(f),d=e.reduce(function(t,e){if(!e[w])throw new Error("States must be decorated with @State() decorator");return t[e[w].name]=e,t},{}),y=[],v=function(e){var t=d[e];if(!t[w])throw new Error("States must be decorated with @State() decorator");var r,n=h[e],o=t[w].actions,a=t[w].defaults;if(t[w].path=n,!_.states.find(function(t){return t.name===e})){Array.isArray(a)?a=O.__spread(a):"object"==typeof(r=a)&&null!==r||"function"==typeof r?a=Object.assign({},a):a===undefined&&(a={});var i=_._injector.get(t);y.push({actions:o,instance:i,defaults:a,name:e,depth:n})}},_=this;try{for(var g=O.__values(l),S=g.next();!S.done;S=g.next()){v(S.value)}}catch(b){s={error:b}}finally{try{S&&!S.done&&(c=g["return"])&&c.call(g)}finally{if(s)throw s.error}}return(p=this.states).push.apply(p,O.__spread(y)),y},t.prototype.addAndReturnDefaults=function(t){if(t){var e=this.add(t);return{defaults:e.reduce(function(t,e){return p(t,e.depth,e.defaults)},{}),states:e}}},t.prototype.connectActionHandlers=function(){var r=this;this._connected||(this._actions.pipe(b.filter(function(t){return"DISPATCHED"===t.status}),b.mergeMap(function(t){var e=t.action;return r.invokeActions(r._actions,e).pipe(b.map(function(){return{action:e,status:"SUCCESSFUL"}}),b.defaultIfEmpty({action:e,status:"CANCELED"}),b.catchError(function(t){return m.of({action:e,status:"ERRORED",error:t})}))})).subscribe(function(t){return r._actionResults.next(t)}),this._connected=!0)},t.prototype.invokeInit=function(t){try{for(var e=O.__values(t),r=e.next();!r.done;r=e.next()){var n=r.value,o=n.instance;if(o.ngxsOnInit){var a=this.createStateContext(n);o.ngxsOnInit(a)}}}catch(s){i={error:s}}finally{try{r&&!r.done&&(u=e["return"])&&u.call(e)}finally{if(i)throw i.error}}var i,u},t.prototype.invokeActions=function(t,e){var r,n,o,a,i=[];try{for(var u=O.__values(this.states),s=u.next();!s.done;s=u.next()){var c=s.value,p=x(e),f=c.actions[p];if(f)try{for(var l=O.__values(f),h=l.next();!h.done;h=l.next()){var d=h.value,y=this.createStateContext(c);try{var v=c.instance[d.fn](y,e);v instanceof Promise&&(v=m.from(v)),v=v instanceof m.Observable?v.pipe(d.options.cancelUncompleted?b.takeUntil(t.pipe(j(e))):b.map(function(t){return t})):m.of({}).pipe(b.shareReplay()),i.push(v)}catch(_){i.push(m.throwError(_))}}}catch(g){o={error:g}}finally{try{h&&!h.done&&(a=l["return"])&&a.call(l)}finally{if(o)throw o.error}}}}catch(S){r={error:S}}finally{try{s&&!s.done&&(n=u["return"])&&n.call(u)}finally{if(r)throw r.error}}return i.length||i.push(m.of({})),m.forkJoin(i)},t.prototype.createStateContext=function(t){return this._stateContextFactory.createStateContext(t)},t}();function N(t,e){return t===e}function F(t,e){void 0===e&&(e=N);var r=null,n=null;return function(){return function(t,e,r){if(null===e||null===r||e.length!==r.length)return!1;for(var n=e.length,o=0;o<n;o++)if(!t(e[o],r[o]))return!1;return!0}(e,r,arguments)||(n=t.apply(null,arguments)),r=arguments,n}}function k(o,n,t){var a=F(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=n.apply(void 0,O.__spread(t));return r instanceof Function?F.apply(null,[r]):r}),i=t&&t.containerClass,e=function(t){t.hasOwnProperty(u)||Object.defineProperty(t,u,{value:{selectFromAppState:null,originalFn:null,containerClass:null,selectorName:null}});return c(t)}(a);return e.originalFn=n,e.selectFromAppState=function(e){var t=[],r=[];i&&s(i)&&r.push(i);o&&r.push.apply(r,O.__spread(o)),r&&t.push.apply(t,O.__spread(r.map(function(t){return D(t)(e)})));try{return a.apply(void 0,O.__spread(t))}catch(n){if(n instanceof TypeError)return undefined;throw n}},t&&(e.containerClass=t.containerClass,e.selectorName=t.selectorName),a}function D(t){var e=c(t);if(e){var r=e.selectFromAppState;if(r)return r}var n=s(t);return n&&n.path?i(n.path.split(".")):t}T.decorators=[{type:e.Injectable}],T.ctorParameters=function(){return[{type:e.Injector},{type:T,decorators:[{type:e.Optional},{type:e.SkipSelf}]},{type:v},{type:E},{type:C}]};var M=function(){function t(t,e,r){this._ngZone=t,this._stateStream=e,this._internalStateOperations=r}return t.prototype.dispatch=function(t){return this._internalStateOperations.getRootStateOperations().dispatch(t)},t.prototype.select=function(t){var e=D(t);return this._stateStream.pipe(b.map(e),b.catchError(function(t){if(t instanceof TypeError)return m.of(undefined);throw t}),b.distinctUntilChanged(),d(this._ngZone))},t.prototype.selectOnce=function(t){return this.select(t).pipe(b.take(1))},t.prototype.selectSnapshot=function(t){return D(t)(this._stateStream.getValue())},t.prototype.subscribe=function(t){return this._stateStream.pipe(d(this._ngZone)).subscribe(t)},t.prototype.snapshot=function(){return this._internalStateOperations.getRootStateOperations().getState()},t.prototype.reset=function(t){return this._internalStateOperations.getRootStateOperations().setState(t)},t}();M.decorators=[{type:e.Injectable}],M.ctorParameters=function(){return[{type:e.NgZone},{type:S},{type:R}]};var U=function(t){};U.store=undefined,U.decorators=[{type:e.Injectable}],U.ctorParameters=function(){return[{type:M}]};var Z=function(){};Z.type="@@INIT";var H=function(){};H.type="@@UPDATE_STATE";var V=function(t,e,r,n,o){var a=t.addAndReturnDefaults(o),i=e.getRootStateOperations();if(a){var u=i.getState();i.setState(Object.assign({},u,a.defaults))}t.connectActionHandlers(),i.dispatch(new Z).subscribe(function(){a&&t.invokeInit(a.states)})};V.decorators=[{type:e.NgModule}],V.ctorParameters=function(){return[{type:T},{type:R},{type:M},{type:U},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[r]}]}]};var L=function(t,e,r,n){var o=[].concat.apply([],O.__spread(n)),a=r.addAndReturnDefaults(o),i=e.getRootStateOperations();if(a){var u=i.getState();i.setState(Object.assign({},u,a.defaults))}i.dispatch(new H).subscribe(function(){a&&r.invokeInit(a.states)})};function G(t){return Object.assign(new a,t)}L.decorators=[{type:e.NgModule,args:[{}]}],L.ctorParameters=function(){return[{type:M},{type:R},{type:T},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[n]}]}]};var q=new e.InjectionToken("ROOT_OPTIONS"),Q=function(){function t(){}return t.forRoot=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e={}),{ngModule:V,providers:O.__spread([T,C,_,v,P,E,R,M,S,U,A],t,[{provide:r,useValue:t},{provide:q,useValue:e},{provide:a,useFactory:G,deps:[q]}])}},t.forFeature=function(t){return{ngModule:L,providers:O.__spread([T,A],t,[{provide:n,multi:!0,useValue:t}])}},t}();Q.decorators=[{type:e.NgModule,args:[{}]}];var X=new RegExp("^[a-zA-Z0-9]+$"),z=function(t){return t+" is not a valid state name. It needs to be a valid object property name."};t.ɵg=v,t.ɵf=y,t.ɵe=U,t.ɵl=E,t.ɵm=P,t.ɵn=C,t.ɵk=T,t.ɵo=R,t.ɵb=L,t.ɵa=V,t.ɵd=q,t.ɵc=G,t.ɵp=A,t.ɵi=n,t.ɵj=a,t.ɵh=r,t.NgxsModule=Q,t.Action=function(f,l){return function(t,e,r){var n,o,a=h(t.constructor);Array.isArray(f)||(f=[f]);try{for(var i=O.__values(f),u=i.next();!u.done;u=i.next()){var s=u.value,c=s.type;if(!s.type)throw new Error("Action "+s.name+' is missing a static "type" property');a.actions[c]||(a.actions[c]=[]),a.actions[c].push({fn:e,options:l||{},type:c})}}catch(p){n={error:p}}finally{try{u&&!u.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}}},t.Store=M,t.State=function(n){return function(t){var e=h(t);if(Object.getPrototypeOf(t).hasOwnProperty(w)){var r=Object.getPrototypeOf(t)[w];e.actions=Object.assign({},e.actions,r.actions)}if(e.children=n.children,e.defaults=n.defaults,e.name=n.name,!n.name)throw new Error("States must register a 'name' property");if(!X.test(n.name))throw new Error(z(n.name))}},t.Select=function(n){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];return function(t,e){var r="__"+e+"__selector";if(n||(n=e.lastIndexOf("$")===e.length-1?e.substring(0,e.length-1):e),t[r])throw new Error("You cannot use @Select decorator and a "+r+" property.");delete t[e]&&(Object.defineProperty(t,r,{writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,e,{get:function(){return this[r]||(this[r]=function(t){var e=U.store;if(!e)throw new Error("SelectFactory not connected to store!");return e.select(t)}.apply(this,["string"==typeof n?i(o.length?O.__spread([n],o):n.split(".")):n[w]&&n[w].path?i(n[w].path.split(".")):n]))},enumerable:!0,configurable:!0}))}},t.Actions=_,t.ofAction=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l(t)},t.ofActionSuccessful=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l(t,"SUCCESSFUL")},t.ofActionDispatched=j,t.ofActionErrored=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l(t,"ERRORED")},t.Selector=function(a){return function(t,e,r){if(null!==r.value){var n=r.value,o=k(a,n,{containerClass:t,selectorName:e});return{configurable:!0,get:function(){return o}}}throw new Error("Selectors only work on methods")}},t.getActionTypeFromInstance=x,t.actionMatcher=function(t){var e=x(t);return function(t){return e===x(t)}},t.createSelector=k,t.NGXS_PLUGINS=o,t.StateStream=S,t.setValue=p,t.getValue=f,t.InitState=Z,t.UpdateState=H,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngxs-store.umd.min.js.map
